<project name="ugli" default="usage" basedir="." >

  <!-- The directory where source files are stored. -->
  <property name="java.source.dir" value="./src/java/"/>

  <!-- Destination for compiled files -->
  <property name="javac.dest" value="./classes"/>

  <property name="tmp.java.source.dir" value="./tmp/src"/>
  <property name="tmp.javac.dest" value="./tmp/classes"/>

	
  <!-- The directory where source files are stored. -->
  <property name="version" value="1.0alpha"/>
  <property name="ugli-simple.jar" value="ugli-simple.jar"/>
  <property name="ugli-nop.jar" value="ugli-nop.jar"/>
  <property name="ugli-jdk14.jar" value="ugli-jdk14.jar"/>

  <!-- Deprecation warning? --> 
  <property name="deprecation" value="on"/>

	
  <property name="UGLI_STEM" value="org/apache/ugli"/>
  

  <!-- ================================================================= -->
  <!-- Default target                                                    -->
  <!-- ================================================================= -->
  <target name="usage">
    <echo>      
      These are some of the targets supported by this ANT build scpript:
      
      build.core - compile core UGLI files.

      ugli-nop.jar - build the jar file of the same name.
      ugli-simple.jar - build the jar file of the same name.
      ugli-jdk14.jar - build the jar file of the same name.
      
    </echo>
  </target>

  <target name="init">
    <mkdir dir="tmp"/>
	<mkdir dir="${tmp.java.source.dir}"/>
	<mkdir dir="${tmp.javac.dest}"/>
  </target>
	
  <!-- ================================================================= -->
  <!-- Remove all generated (compiled) class files.                      -->
  <!-- ================================================================= -->
  <target name="clean" description="Delete all compiled UGLI files.">
    <delete dir="${javac.dest}/org/apache/ugli" />
  </target>

  <!-- ================================================================== -->
  <!-- Copy UGLI files into log4j source tree. This step is necessary for -->
  <!-- building log4j. However, it needs to be done whenever code in UGLI -->
  <!-- changes                                                            -->
  <!-- ================================================================== -->
  <target name="copy-into-log4j">	
  	<!-- delete any stale copy of LoggerFactory.java -->
 	<delete><fileset dir="src/java/org/apache/ugli" includes="LoggerFactory.java"/></delete>
  	
   	<!-- copy a filtered version of ugli to tmp/src -->
  	<copy todir="src/java">
  	  <fileset dir="src/filtered-java">
  	  	<include name="**/*.java"/>
  	    <exclude name="**/impl/JDK14*.java"/>
  	  </fileset>
  	  <filterset><filter token="IMPL" value="Log4j"/></filterset>
  	</copy>
  </target>


  <target name="julCheck">
    <available classname="java.util.logging.Logger" property="julPresent">
    </available>

  	<fail unless="julPresent">
        Building the UGLI implementation for JDK 1.4 logging 
        requires the presence of JDK 1.4 or later.
  	</fail>
  </target>

  <!-- =================================================================== -->
  <!-- Generic target that can build NOP, Simple and JDK14 implementations -->
  <!--  as specified by the "jar-name" and "impl" parameters.              -->
  <!-- =================================================================== -->
  <target name="ugli-IMPL.jar">
    
    <!-- delete all previously existing files in tmp -->
  	<delete><fileset dir="tmp/" includes="**/*"/></delete>

   	<!-- copy a filtered version of ugli to tmp/src -->
  	<copy todir="tmp/src">
  	  <fileset dir="src/filtered-java">
  	  	<include name="**/*.java"/>
  	  </fileset>
  	  <filterset><filter token="IMPL" value="${IMPL}"/></filterset>
  	</copy>
    	
    <javac srcdir="${tmp.java.source.dir}"
           destdir="${tmp.javac.dest}"
           deprecation="on"
           includes="${UGLI_STEM}/*.java,
    	             ${UGLI_STEM}/impl/MessageFormatter.java, 
                     ${UGLI_STEM}/impl/${impl}*.class"
           debug="${debug}">
    </javac>
 
    <jar jarfile="${jar-name}" basedir="${tmp.javac.dest}"
        includes="${UGLI_STEM}/*.class, 
                  ${UGLI_STEM}/impl/MessageFormatter.class, 
                  ${UGLI_STEM}/impl/${IMPL}*.class"
                >
      <manifest>
        <attribute name="Manifest-version" value="1.0"/>
        <section name="org/apache/ugli/">
          <attribute name="Implementation-Title" value="${IMPL} implementation"/>
          <attribute name="Implementation-Version" value="${version}"/>
          <attribute name="Implementation-Vendor" value="Apache Software Foundation"/>
        </section>
      </manifest>
    </jar>
   
  </target>

  <target name="ugli-nop.jar" depends="init">
    <antcall target="ugli-IMPL.jar">
      <param name="IMPL" value="NOP"/>
      <param name="jar-name" value="${ugli-nop.jar}"/>
    </antcall>
  </target>

  <target name="ugli-simple.jar" depends="init">
    <antcall target="ugli-IMPL.jar">
      <param name="IMPL" value="Simple"/>
      <param name="jar-name" value="${ugli-simple.jar}"/>
    </antcall>
  </target>

  <target name="ugli-jdk14.jar" depends="init, julCheck">
    <antcall target="ugli-IMPL.jar">
      <param name="IMPL" value="JDK14"/>
      <param name="jar-name" value="${ugli-jdk14.jar}"/>
    </antcall>
  </target>

  <target name="jar" depends="ugli-nop.jar, ugli-simple.jar, ugli-jdk14.jar"/> 	

</project>
