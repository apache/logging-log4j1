<project name="ugli" default="usage" basedir="." >

  <!-- The directory where source files are stored. -->
  <property name="java.source.dir" value="./src/java/"/>

  <!-- The directory where source files are stored. -->
  <property name="version" value="1.0alpha"/>

  <!-- Deprecation warning? --> 
  <property name="deprecation" value="on"/>
  
  <!-- Destination for compiled files -->
  <property name="javac.dest" value="./classes"/>
  
  
  <property name="UGLI_STEM" value="org/apache/ugli"/>
  
  <property name="path2ugli.properties" value="./classes/ugli.properties"/>

  <!-- ================================================================= -->
  <!-- Default target                                                    -->
  <!-- ================================================================= -->
  <target name="usage">
    <echo>      
      These are some of the targets supported by this ANT build scpript:
      
      build.core - compile core UGLI files.

      ugli-nop.jar - build the jar file of the same name.
      ugli-simple.jar - build the jar file of the same name.
      ugli-jdk14.jar - build the jar file of the same name.
      
    </echo>
  </target>


  <!-- ================================================================= -->
  <!-- Remove all generated (compiled) class files.                      -->
  <!-- ================================================================= -->
  <target name="clean" description="Delete all compiled UGLI files.">
    <delete dir="${javac.dest}/org/apache/ugli" />
    <delete file="${path2ugli.properties}"/>
  </target>


  <!-- Build as many source files as we can, except those requiring 
       JDK 1.4 -->
  <target name="build.core" depends="">
    
    <mkdir dir="${javac.dest}" />
    <javac srcdir="${java.source.dir}"
           destdir="${javac.dest}"
           deprecation="on"
           includes="${UGLI_STEM}/**/*.java"
           excludes="${UGLI_STEM}/impl/JDK14*.java"
           debug="${debug}">
    </javac>
  </target>

  <target name="jdk14Check">
    <available classname="java.util.logging.Logger"
               property="jdk14.present">
    </available>
  </target>

  <target name="build.jdk14" depends="build.core, jdk14Check">
    
    <fail unless="jdk14.present">

       Building the UGLI implementation for JDK 1.4 logging 
       requires the presence of JDK 1.4 or later.
    </fail>

    <javac srcdir="${java.source.dir}"
           destdir="${javac.dest}"
           deprecation="on"
           includes="${UGLI_STEM}/impl/JDK14*.java"
           debug="${debug}">
    </javac>
  </target>


  <!-- Generic target that can build NOP, Simple and JDK14 implementations
       as specified by the "jar-name" and "impl" parameters. -->
  <target name="ugli-IMPL.jar" depends="build.core">
    
    <delete file="${path2ugli.properties}"/>

    <!-- Much depends on setting up ugli.properties file correctly -->
    <propertyfile file="${path2ugli.properties}" comment="${impl} Logger implementation">
      <entry key="ugli.factoryAdapterClass" value="org.apache.ugli.impl.${impl}LoggerFA"/>
    </propertyfile>

    <!-- the NOP classes should always be included -->
    <jar jarfile="${jar-name}" basedir="${javac.dest}"
        includes="ugli.properties,
                ${UGLI_STEM}/*.class, 
                ${UGLI_STEM}/impl/MessageFormatter.class, 
                ${UGLI_STEM}/impl/NOP*.class,
                ${UGLI_STEM}/impl/${impl}*.class"
                >
               <manifest>
       <attribute name="Manifest-version" value="1.0"/>
       <section name="org/apache/ugli/">
         <attribute name="Implementation-Title" value="${impl} implementation"/>
         <attribute name="Implementation-Version" value="${version}"/>
         <attribute name="Implementation-Vendor" value="Apache Software Foundation"/>
       </section>
     </manifest>
    </jar>
    
    <!-- remove ugli.properties when done -->
    <delete file="${path2ugli.properties}"/>
  </target>

  <target name="ugli-nop.jar" depends="build.core">
    <antcall target="ugli-IMPL.jar">
      <param name="impl" value="NOP"/>
      <param name="jar-name" value="ugli-nop.jar"/>
    </antcall>
  </target>

  <target name="ugli-simple.jar" depends="build.core">
    <antcall target="ugli-IMPL.jar">
      <param name="impl" value="Simple"/>
      <param name="jar-name" value="ugli-simple.jar"/>
    </antcall>
  </target>

  <target name="ugli-jdk14.jar" depends="build.jdk14">
    <antcall target="ugli-IMPL.jar">
      <param name="impl" value="JDK14"/>
      <param name="jar-name" value="ugli-jdk14.jar"/>
    </antcall>
  </target>


</project>
