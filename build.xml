 
<!-- This file is intended for ANT, a Java based build tool. ANT is
     availale from http://jakarta.apache.org/ant/index.html
  -->

<project name="log4j" default="compile" basedir="." >
	<target name="init">
		<tstamp />
		<property name="srcdir" value="." />
		<property name="classes" value="classes" />
		<property name="stem" value="org/apache/log4j" />
		<property name="build.compiler" value="jikes"/>	
		<property name="version" value="1.0"/>

		<available classname="javax.swing.JTextPane"
 	                   property="swing-present"/>

	        <available classname="org.apache.xerces.parsers.DOMParser"
 	                   property="xerces-present"/>

	        <available classname="junit.framework.TestCase"
 	                   property="junit-present"/>

                <available classname="javax.jms.Message"
 	                   property="jms-present"/>

                <available classname="javax.naming.Context"
 	                   property="jndi-present"/>

	        <available classname="javax.mail.Message"
 	                   property="javamail-present"/>


	</target>

	<target name="compile" depends="init,
	                                compile.core,
					compile.swing,
					compile.unitTests,
					compile.xml,
					compile.javamail,
					compile.jms"/>

	<target name="compile.core" depends="init">
		<mkdir dir="${classes}" />
		<javac srcdir="${srcdir}"
		       destdir="${classes}"
		       includes="${stem}/**/*.java, ${stem}/xml/XMLLayout.java,"
		       classpath="${classpath}"
		       excludes="misc/*, **/UnitTest*.java,
		                 **/doc-files/*,
               		         ${stem}/xml/**,
				 ${stem}/net/SMTPAppender.java,
               		         ${stem}/net/JMS*.java,
				 **/pending/**" 
		       debug="on"
		       optimize="on"/>
		<copy file="${stem}/xml/log4j.dtd"
		          tofile="${classes}/${stem}/xml/log4j.dtd" />
		
         </target>

	 <target name="compile.swing" depends="init" if="swing-present">   
            <echo message="Really compiling graphic components." />
	    <mkdir dir="${classes}/icons"/>
            <copy todir="${classes}/icons">
		<fileset dir="icons"/>
            </copy>
	    <javac srcdir="${srcdir}"
		   destdir="${classes}"
		   includes="${stem}/gui/*.java"
                   excludes="**/JListView.java, **/JTableAppender.java"
		   classpath="${classpath}"/>
	</target>
	
	 <target name="compile.unitTests" depends="init" if="junit-present">   
            <echo message="Really compiling unit tests." />
	    <javac srcdir="${srcdir}"
		   destdir="${classes}"
		   includes="**/UnitTest*.java"
		   classpath="${classpath}"/>
	</target>
	
         <target name="compile.xml" depends="init" if="xerces-present">   
            <echo message="Really compiling org.log4j.xml" />
	    <javac 
		   srcdir="${srcdir}"
		   destdir="${classes}"
		   includes="${stem}/xml/**/*.java"
                   excludes="${stem}/xml/examples/doc-files/**.java"
		   classpath="${classpath}"/>
	</target>

         <target name="compile.javamail" depends="init" 
                       if="javamail-present">   
            <echo message="Really compiling org.log4j.net.SMTPAppender" />
	    <javac 
		   srcdir="${srcdir}"
		   destdir="${classes}"
		   includes="${stem}/net/SMTPAppender.java"
		   classpath="${classpath}"/>
	</target>

         <target name="compile.jms" depends="init" if="jms-present">   
            <echo message="Really compiling JMS dependent code." />
	    <javac 
		   srcdir="${srcdir}"
		   destdir="${classes}"
		   includes="${stem}/net/JMS*.java"
		   classpath="${classpath}"/>
	</target>


	
	<target name="clean" depends="init">
		<delete dir="${classes}" />
	</target>

        <target name="jar" depends="log4j-core.jar, log4j.jar"/>
	
	<!-- Create log4j-core.jar, exluding non-core files -->
	<target name="log4j-core.jar" depends="compile">
	        <delete file="log4j-core.jar"/>
		<jar jarfile="log4j-core.jar" basedir="${classes}"
		includes="**/log4j/*.class, **/log4j/helpers/*.class,
                          **/log4j/spi/*.class, **/log4j/or/*.class"
		excludes="**/StressCategory*, **/TTCC*, 
		          **/SimpleLayout.*, **/AsyncAppender.*,
			  **/Dispatcher.*, **/BoundedFIFO.*,
		          **/Syslog*, **/RelativeTimeDateFormat.*,
			  **/gui/**/*.class, **/Loader.class,
			  **/UnitTest*.class, 
			  org/apache/log4j/helpers/CyclicBuffer.class"
                manifest="manifest.mf"
		/>
	</target>
	
	<!-- Create log4j.jar, excluding tests and other odds and
  	     ends. -->
	<target name="log4j.jar" depends="compile">
		<delete file="log4j.jar"/>
		<jar jarfile="log4j.jar" basedir="${classes}"
		includes="**/log4j/*.class, ${stem}/xml/log4j.dtd, 
		          **/log4j/helpers/*.class, icons/**,
			  **/log4j/spi/*.class,  **/log4j/net/*.class,
			  **/log4j/varia/*.class, **/log4j/nt/*.class,
			  **/log4j/xml/*.class, 
			  **/log4j/or/*.class,
			  **/log4j/gui/TextPaneAppender.class"
		excludes="**/StressCategory*, **/UnitTest**"
                manifest="manifest.mf"
		/>
	</target>

	<!-- In linkoffline attribute we trick the shell to see two sepatate
	arguments -->
	<target name="javadoc" depends="init">
		<mkdir dir="javadoc" />

		<copy file="doc/od.gif"
		      tofile="javadoc/od.gif" />

		<copy file="doc/manual.html"
		      tofile="javadoc/manual.html" />

		<javadoc sourcepath="${srcdir}" 
		   destdir="javadoc" 
		   packagenames="org.apache.log4j,
			         org.apache.log4j.spi,
			         org.apache.log4j.or,
                                 org.apache.log4j.helpers,
		                 org.apache.log4j.performance,
			         org.apache.log4j.xml,
				 org.apache.log4j.examples,
			         org.apache.log4j.net,
				 org.apache.log4j.nt,
				 org.apache.log4j.varia,
			         org.apache.log4j.xml.examples"
		   protected="true"				       
		   version="true"
		   author="true"
		   use="true"		   
		   overview="doc/overview.html"
		   doctitle="log4j version ${version}&lt;br&gt;API Specification"
		   windowtitle="Log4j Version ${version}" 
                   header="&lt;b&gt;Log4j ${version}&lt;/b&gt;"
  		   bottom="Please &lt;a href=http://lists.sourceforge.net/mailman/listinfo/log4j-announce&gt;&lt;b&gt;notify me&lt;/b&gt;&lt;/a&gt; about new log4j releases. &lt;hr&gt;"> 
		   
		   <link offline="true" 
		         href="http://java.sun.com/products/jdk/1.2/docs/api"
                         packageListLoc="packaging"/>
		</javadoc>
		
	</target>

</project>
